[Unit]
Description="HashiCorp Vault - A tool for managing secrets"
Documentation=https://www.vaultproject.io/docs/
Requires=network-online.target
After=network-online.target
ConditionFileNotEmpty={{ vault_config_file }}

[Service]
EnvironmentFile=-/etc/vault/vault.env # Optional: load environment variables securely.
User={{ vault_user }}
Group={{ vault_group }}
ExecStart={{ vault_binary }} server -config={{ vault_config_file }}
ExecReload=/bin/kill --signal HUP $MAINPID
KillMode=process
Restart=on-failure
LimitNOFILE=65536
LimitMEMLOCK=infinity
RestartSec=5
TimeoutStopSec=30
StartLimitBurst=3
KillSignal=SIGINT

# Sandbox directives
ProtectSystem=true             # Makes system directories read-only.
ProtectSystem=full
ProtectHome=read-only               # Restricts access to home directories.
PrivateTmp=yes               # Isolates the process's temporary files.
PrivateDevices=yes          # Blocks access to /dev.
NoNewPrivileges=yes

SecureBits=keep-caps
AmbientCapabilities=CAP_IPC_LOCK
CapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK


# Environment variable sanitization
Environment="VAULT_SKIP_VERIFY=true"  # Add required env vars securely.


[Install]
WantedBy=multi-user.target
